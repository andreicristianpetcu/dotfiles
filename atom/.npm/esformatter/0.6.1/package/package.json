{"name":"esformatter","version":"0.6.1","description":"ECMAScript code beautifier/formatter","main":"lib/esformatter.js","bin":{"esformatter":"./bin/esformatter"},"scripts":{"test":"node test/runner.js","lint":"jshint lib/*.js lib/**/*.js test/*.js"},"repository":{"type":"git","url":"https://github.com/millermedeiros/esformatter.git"},"bugs":{"url":"https://github.com/millermedeiros/esformatter/issues"},"keywords":["beautifier","beautify","formatter","ecmascript","javascript","syntax","source","esprima"],"author":{"name":"Miller Medeiros","url":"http://blog.millermedeiros.com/"},"devDependencies":{"chai":"1.4","esformatter-pipe-test":"file:test/pipe","esformatter-test-plugin":"file:test/plugin","esprima":"^2.0.0","glob":"3.1","jshint":"~2.3.0","mocha":"https://github.com/millermedeiros/mocha/tarball/latest","mockery":"^1.4.0"},"dependencies":{"debug":"^0.7.4","mout":">=0.9 <2.0","npm-run":"^1.1.1","optimist":"~0.6.0","resolve":"^1.1.5","rocambole":">=0.5 <2.0","rocambole-indent":"^2.0.3","rocambole-linebreak":"^1.0.0","rocambole-node":"~1.0","rocambole-token":"^1.1.2","rocambole-whitespace":"^1.0.0","semver":"~2.2.1","stdin":"*","strip-json-comments":"~0.1.1"},"license":"MIT","readme":"# esformatter\n\n[![Build Status](https://secure.travis-ci.org/millermedeiros/esformatter.svg?branch=master)](https://travis-ci.org/millermedeiros/esformatter)\n\nECMAScript code beautifier/formatter.\n\nLive preview: [lloiser/esformatter-visualize](http://lloiser.github.io/esformatter-visualize/)\n\n\n## Important\n\nThis tool is still on early development and is missing support for many\nimportant features. Please report any bugs you find, the code is only as good\nas the test cases.\n\n**We are looking for [contributors](https://github.com/millermedeiros/esformatter/blob/master/CONTRIBUTING.md)!!**\n\n\n\n## Why?\n\n[jsbeautifier.org](http://jsbeautifier.org/) doesn't have enough options and\nnot all IDEs/Editors have a good JavaScript code formatter. I would like to\nhave a command line tool (and standalone lib) as powerful/flexible as the\n[WebStorm](http://www.jetbrains.com/webstorm/) and\n[FDT](http://fdt.powerflasher.com/) code formatters.\n\nThis tool could also be reused by other node.js libs like\n[escodegen](https://github.com/Constellation/escodegen/) to format the output\n(so each lib has a single responsibility).\n\nFor more reasoning behind it and history of the project see: [esformatter\n& rocambole](http://blog.millermedeiros.com/esformatter-rocambole/)\n\n\n\n## How?\n\nThis tool uses [rocambole](https://github.com/millermedeiros/rocambole) (based\non Esprima) to recursively parse the tokens and transform it *in place*.\n\n\n\n## Goals\n\n - *granular* control about white spaces, indent and line breaks.\n - command line interface (cli).\n - be non-destructive.\n - support for local/global config file so settings can be shared between team\n   members.\n - support most popular style guides (Google, jQuery, Idiomatic.js).\n - be the best JavaScript code formatter.\n\n\n\n## API\n\n### esformatter.format(str[, opts]):String\n\n`format()` method receives a string containing the code that you would like to\nformat and the configuration options that you would like to use and returns\na string with the result.\n\n```js\nvar esformatter = require('esformatter');\n\n// for a list of available options check \"lib/preset/default.json\"\nvar options = {\n    // inherit from the default preset\n    preset : 'default',\n    indent : {\n        value : '  '\n    },\n    lineBreak : {\n        before : {\n            // at least one line break before BlockStatement\n            BlockStatement : '>=1',\n            // only one line break before BlockStatement\n            DoWhileStatementOpeningBrace : 1,\n            // ...\n        }\n    },\n    whiteSpace : {\n        // ...\n    }\n};\n\nvar fs = require('fs');\nvar codeStr = fs.readFileSync('path/to/js/file.js').toString();\n\n// return a string with the formatted code\nvar formattedCode = esformatter.format(codeStr, options);\n```\n\n### esformatter.transform(ast[, opts]):AST\n\nor you can use the `transform()` method to manipulate an AST in place (allows\npipping other tools that manipulates the AST). - so far only supports\n[rocambole](https://github.com/millermedeiros/rocambole) generated ASTs, but we\nwill work to fix this limitation in the future (see [issue #86](https://github.com/millermedeiros/esformatter/issues/86)).\n\n```js\nvar inputAST = rocambole.parse('var foo=123;');\n// you can also pass the formatting options as second argument like the\n// `format` method\nvar outputAST = esformatter.transform(inputAST);\nassert(outputAST === inputAST, 'edits AST in place');\nassert(outputAST.toString() === 'var foo = 123;', 'formats input');\n```\n\n### esformatter.rc([filePath], [customOptions]):Object\n\nUsed by task runners and/or plugin authors to retrieve the configuration stored\non `.esformatter` and `package.json` files relative to the `filePath`, `cwd` or\nglobal config file (`~/.esformatter`) if it can't find any config file until\nthe root path.\n\nYou can also pass an object with `customOptions` to override the default\noptions.\n\n`rc` will merge the options from multiple [config files](#configuration).\n\n```js\n// will start search from the \"foo/bar\" directory\nvar baseConfig = esformatter.rc('foo/bar/baz.js');\n// will start the search from cwd\nvar otherConfig = esformatter.rc();\n// merge some custom options to the user settings\nvar override = esformatter.rc({\n  indent: { value: '\\t' }\n});\n```\n\n### esformatter.register(plugin)\n\nRegister a [plugin](#plugins) module.\n\n```js\nvar plugin = {\n  nodeAfter: function(node) {\n    // called once for each node, after the esformatter manipulation\n  }\n};\nesformatter.register(plugin);\n```\n\n### esformatter.unregister(plugin)\n\nRemove [plugin](#plugins) from the execution queue.\n\n```js\nesformatter.unregister(pluginObject);\n```\n\n### esformatter.unregisterAll()\n\nRemove all the registered plugins from the execution queue; useful in case you\nwant to edit multiple files using different plugins each time.\n\n\n\n## CLI\n\nYou can also use the simple command line interface to process `stdin` and\n`stdout` or read from a file.\n\n```sh\nnpm install -g esformatter\n```\n\n### Usage:\n\n````sh\nesformatter [OPTIONS] [FILES]\n\nOptions:\n  -c, --config   Path to custom configuration file.\n  -p, --preset   Set style guide preset (\"jquery\", \"default\").\n  -h, --help     Display help and usage details.\n  -v, --version  Display the current version.\n  --plugins      Comma separated list of plugins.\n  -i             Edit input files in place.\n````\n\n### Examples:\n\n```sh\n# format \"test.js\" and output result to stdout\nesformatter test.js\n# you can also pipe other shell commands (read file from stdin)\ncat test.js | esformatter\n# format \"test.js\" using options in \"options.json\" and output result to stdout\nesformatter --config options.json test.js\n# process \"test.js\" and writes to \"test.out.js\"\nesformatter test.js > test.out.js\n# you can override the default settings, see lib/preset/default.json for\n# a list of available options\nesformatter test.js --indent.value=\"\\t\" --lineBreak.before.IfStatementOpeningBrace=0\n# format \"test.js\" and output result to \"test.js\"\nesformatter -i test.js\n```\n\n### Local version\n\nIf a locally installed `esformatter` is found, the CLI uses that instead of the\nglobal executable (this means you can have multiple projects depending on\ndifferent versions of esformatter).\n\n**protip:** add `esformatter` and all the plugins that you need on your project\nto the [package.json `devDependencies`](https://docs.npmjs.com/files/package.json#devdependencies)\nthat way you can use locally installed plugins and also make sure everyone on\nyour team is using the same version/settings.\n\n```json\n{\n  \"devDependencies\": {\n    \"esformatter\": \"~0.6.0\",\n    \"esformatter-quotes\": \"^1.0.1\"\n  },\n  \"esformatter\": {\n    \"plugins\": [\"esformatter-quotes\"],\n    \"quotes\": {\n      \"type\": \"single\"\n    }\n  }\n}\n```\n\n### Configuration\n\nFor a live preview check [esformatter-visualize](http://lloiser.github.io/esformatter-visualize/)\n\n`esformatter` will look for the closest `.esformatter` file and use that as\na setting unless you specify `--preset` or `--config`.\n\nYou also have the option to put your `esformatter` settings inside the\n`package.json` file under the `esformatter` property.\n\nSettings from multiple files will be merged until it finds a config file that\ncontains the property `\"preset\"` or `\"root\": true`; that makes it easy to\ndefine exceptions to the project rules without needing to copy all the shared\nproperties. - for an example see test files inside the `\"test/compare/rc\"`\nfolder.\n\nThe `\"preset\"` property is used to set the `prototype` of the config file,\nenabling inheritance. For instance, you can say your config inherits from the\n`jquery` preset and only override the settings you need:\n\n```json\n{\n  \"preset\": \"jquery\",\n  \"indent\": {\n    \"value\": \"  \"\n  }\n}\n```\n\nPS: the [jQuery preset](https://github.com/millermedeiros/esformatter/issues/19) is still under development.\n\n\nConfiguration in esformatter consists of three main building blocks:\n\n#### indent\n\nIndent is responsible for whitespace at the front of each line. `indent.value` is used for each indentation. The default indents with two spaces. Setting `indent.value` to `\"\\t\"` will switch to indentation using tabs.\n\nThe other properties for indent toggle indentation for specific elements. These all refer to regular JavaScript statements except for TopLevelFunctionBlock. This is enabled by default, with no special behaviour. When disabled (set to `0`), esformattter will not indent top level function blocks (used by the jQuery preset).\n\n#### lineBreak and whiteSpace\n\nBoth of these have `value`, `before` and `after` properties. `lineBreak`'s value is `\"\\n\"` by default, while whiteSpace uses a single space (`\" \"`). Its unlikely that you ever need to change these.\n\nMore interesting are all the properties nested under `before` and `after`. These refer to various elements of JavaScript syntax, where the terms mostly match the names used by the Abstract Syntax Tree (AST) for JavaScript. A lot of them have \"...Opening\", \"...Closing\", \"...OpeningBrace\" and \"...ClosingBrace\" as variants, allowing very fine grained control over each settings.\n\nDocumenting each property here wouldn't be practical. For now we recommend you look at the existing presets (default and jquery) to find the properties you need to adjust for your specific needs. Better yet, adopt one of the presets to avoid having to configure anything beyond the most basic settings (like `indent.value`).\n\nFor `lineBreak` you can use ranges or integers:\n\n - positive integer (`1` till `99`): \"add or keep `[n]` line breaks\".\n - `-1`: keep original line breaks.\n - `\">2\"`: add linebreaks until it's over `2`.\n - `\">=1\"`: add line breaks until it's equal or greater than `1`.\n - `\"<2\"`: remove linebreaks until it's smaller than `2`.\n - `\"<=1\"`: remove/add line breaks until it's smaller or equal to `1`.\n\nFor `whiteSpace` you can only use positive integers for now (any positive number between `1` and `99`) or `-1` when you want to keep the original value.\n\n\n## Pipe other CLI tools\n\nSince we don't expect everyone to write plugins that only works with\nesformatter we decided to encourage the usage of standalone CLI tools.\n\n```js\n{\n  // pipe is a simple way to \"pipe\" multiple binaries input/output\n  \"pipe\": {\n    // scripts listed as \"before\" will be executed before esformatter\n    // and will forward output to next command in the queue\n    \"before\": [\n      \"strip-debug\",\n      \"./bin/my-custom-script.sh --foo true -zx\"\n    ],\n    // scripts listed as \"after\" will be executed after esformatter\n    \"after\": [\n      \"baz --keepLineBreaks\"\n    ]\n  }\n}\n```\n\nThe pipe option works by passing the string input to `stdin` of the first\nexecutable and piping the `stdout->stdin` of each tool. The executables will be\nexecuted in the same order as they are listed, `before` or `after` the default\n`esformatter` transformations.\n\nThe `pipe` option works similar to `npm run-script`, where it locates the\nlocally installed executables inside the `node_modules` folder. If it can't\nfind a local executable it will fallback to global commands. (this allows you\nto install `devDependencies` that are only used by a single project)\n\n\n## Plugins\n\nEsformatter also have support for plugins (v0.2.0+).\n\nJavaScript is a very flexible language, which means people write it in many\ndifferent ways, since adding support for every single kind of style would be\n*impossible*, we decided to introduce plugins; that should give enough\nflexibility to tailor the formatting to match the craziest needs.\n\nPlugins are automatically loaded from `node_modules` if you pass the module id\nin the config file:\n\n```json\n{\n  \"indent\": {\n    \"value\": \"\\t\"\n  },\n  \"plugins\": [\"esformatter-sample-plugin\", \"foobar\"]\n}\n```\n\nList of plugins and plugins wish list: https://github.com/millermedeiros/esformatter/wiki/Plugins\n\nYou also have the option to `register` a plugin programmatically:\n\n```js\nvar plugin = {\n  nodeAfter: function(node) {\n    // transform node here\n  }\n};\nesformatter.register(plugin);\n```\n\nPlugins are executed in the same order as they are registered (first in, first\nout).\n\nThe plugin methods are executed in the following order: `setOptions` > `stringBefore` > `transformBefore`  > `tokenBefore` > `nodeBefore` > `nodeAfter` > `tokenAfter` > `transformAfter` > `stringAfter`.\n\n**All plugin methods are optional.**\n\n**IMPORTANT:** If you need to edit the structure of the AST (add/remove nodes,\nchange the order of elements) we recommend you to write it as a standalone CLI\ntool whenever possible and use the `pipe` option instead of writting a plugin\n(eg. [strip-debug](https://www.npmjs.com/package/strip-debug)). Plugins should\nideally only add/remove/edit the `WhiteSpace`, `Indent`, `LineBreak` and\n`Comment` tokens, otherwise you might have conflicts with other plugins and\nesformatter itself.\n\n**protip:** You can use\n[rocambole-token](https://github.com/millermedeiros/rocambole-token) and\n[rocambole-node](https://github.com/millermedeiros/rocambole-node) to simplify\nthe AST manipulation process.\n\n\n### setOptions(options)\n\nCalled once before any manipulation, the object is shared with the esformatter\nwhich means you can use this method to override default options if needed.\n\n```js\nvar options;\n\nplugin.setOptions = function(opts) {\n  // override the default settings (objects are passed by reference, changing\n  // the value here will also change the value used by esformatter)\n  opts.indent.value = '  ';\n  // store the options to be used later\n  options = opts;\n};\n```\n\n### stringBefore(inputString):String\n\nA way to replace the input string, it should **ALWAYS** return a string.\n\n```js\nplugin.stringBefore = function(str) {\n  // prepend a variable declaration to the file\n  return 'var foo = \"bar\";\\n' + str;\n};\n```\n\nPS: you should only really use this method if you need to store some state\nduring `stringBefore` to be used by your other methods; otherwise favor the\n`pipe` option.\n\n### stringAfter(outputString):String\n\nReplaces the output string.\n\n```js\nplugin.stringAfter = function(str) {\n  // replaces all the occurances of \"foo\" with \"bar\" (very naive)\n  // using regular expressions or string manipulation methods to process code\n  // is very error-prone! BEWARE!\n  return str.replace(/foo/g, 'bar');\n};\n```\n\nPS: you should only really use this method if you need to recover from some of\nthe changes you introduced by the other plugin methods; otherwise favor the\n`pipe` option.\n\n### tokenBefore(token)\n\nCalled once for each token (eg. Keyword, Punctuator, WhiteSpace, Indent...)\nbefore processing the nodes. Can be used to manipulate the token value or\nadd/remove/replace the token or tokens around it.\n\n```js\nvar tk = require('rocambole-token');\n\nplugin.tokenBefore = function(token) {\n  if (tk.isSemiColon(token) && tk.isSemiColon(token.next)) {\n    // remove semicolon if next token is also a semicolon\n    tk.remove(token);\n  }\n};\n```\n\n### tokenAfter(token)\n\nCalled once for each token (eg. Keyword, Punctuator, WhiteSpace, Indent...)\nafter processing all the nodes. Can be used to manipulate the token value or\nadd/remove/replace the token or tokens around it.\n\n### nodeBefore(node)\n\nCalled once for each `node` of the program (eg. VariableDeclaration,\nIfStatement, FunctionExpression...) before the esformatter default\nmanipulations.\n\n### nodeAfter(node)\n\nCalled once for each `node` of the program (eg. VariableDeclaration,\nIfStatement, FunctionExpression...) after the esformatter default\nmanipulations.\n\n```js\nvar tk = require('rocambole-token');\n\nplugin.nodeAfter = function(node) {\n  if (node.type === 'FunctionExpression' || node.type === 'FunctionDeclaration') {\n    if (node.body) {\n      // insert a line break before the function body\n      tk.before(node.body.startToken, {\n        type: 'LineBreak',\n        value: options.lineBreak.value\n      });\n    }\n  }\n};\n```\n\n### transformBefore(ast)\n\nCalled before esformatter loops through all the nodes, it receives the whole\nAST in case you need a different loop strategy than `rocambole.moonwalk`. In\nmost cases the `nodeBefore` method is enough.\n\nThis method **should only** be used to add/remove `WhiteSpace`, `LineBreak` and\n`Indent` tokens.\n\nIt's very important to note that adding/removing/reordering `nodes` might cause\nsome serious problems on the code formatting. esformatter will skip nodes\nunless you instrument them properly (adding all the properties that\n`rocambole.moonwalk`, `rocambole.recursive` and future plugins expects) so it\nis not recommended to do it here.\n\nIf you need to edit the tree structure please use the `stringBefore` method or\nwrite a standalone CLI tool that can be used on the `pipe` setting.\n\n### transformAfter(ast)\n\nCalled after all nodes and tokens are processed, allows overriding all the\nchanges (including indentation).\n\nThis method **should only** be used to add/remove `WhiteSpace`, `LineBreak` and\n`Indent` tokens.\n\n```js\nvar rocambole = require('rocambole');\n\nplugin.transformAfter = function(ast) {\n  // if you need to manipulate multiple nodes you can use the\n  // rocambole.moonwalk or rocambole.walk methods. we don't do it\n  // automatically since you might have very specific needs\n  rocambole.moonwalk(ast, function(node) {\n    doStuff(node);\n  });\n};\n```\n\nIt's very important to note that adding/removing/reordering `nodes` might cause\nundesired side effects on other plugins (`rocambole.moonwalk` and\n`rocambole.walk` might not work as expected and/or you might forget some\n`node.[start|end]Token` and/or `token.[next|prev]` and break other plugins). So\nif you need to edit the tree structure please use the `stringAfter` method or\nwrite a standalone CLI tool that can be used on the `pipe` setting.\n\n\n## IRC\n\nWe have an IRC channel [#esformatter on\nirc.freenode.net](http://webchat.freenode.net/?channels=esformatter) for quick\ndiscussions about the project development/structure.\n\n\n## Wiki\n\nSee project Wiki for more info: https://github.com/millermedeiros/esformatter/wiki\n\n\n\n## Project structure / Contributing\n\nSee [CONTRIBUTING.md](https://github.com/millermedeiros/esformatter/blob/master/CONTRIBUTING.md)\n\n\n\n## Popular Alternatives\n\n - [jsbeautifier](http://jsbeautifier.org/)\n\n\n\n## License\n\nReleased under the MIT license\n\n\n","readmeFilename":"README.md","homepage":"https://github.com/millermedeiros/esformatter","_id":"esformatter@0.6.1","_shasum":"b0bac9b1bde3793bc0cff2c590f940cc86ad4bc4","_resolved":"https://registry.npmjs.org/esformatter/-/esformatter-0.6.1.tgz","_from":"https://registry.npmjs.org/esformatter/-/esformatter-0.6.1.tgz"}